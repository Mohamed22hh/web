<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Environmental Monitoring System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap');

        :root {
            --primary-green: #28a745;
            --secondary-green: #218838;
            --light-green: #4caf50;
            --gradient-light: linear-gradient(to right, #a8e063, #56ab2f);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f9f9f9;
            color: #333;
            overflow-x: hidden;
        }

        .navbar {
            background: var(--gradient-light);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand, .navbar-nav .nav-link {
            color: white !important;
            font-weight: 500;
        }

        .navbar-nav .nav-link:hover {
            color: #f9f9f9 !important;
            text-decoration: underline;
        }

        .section-label {
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 40px;
            position: relative;
            text-align: center;
            color: var(--secondary-green);
        }

        .section-label::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background-color: var(--primary-green);
        }

        .feature-card {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .feature-card i {
            font-size: 3rem;
            color: var(--primary-green);
            margin-bottom: 15px;
        }

        .btn {
            border-radius: 30px;
            padding: 10px 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .dashboard-button {
            background: var(--gradient-light);
            color: white;
            border: none;
        }

        .dashboard-button:hover {
            background: var(--light-green);
            color: #f9f9f9;
            transform: scale(1.05);
        }

        .code-container {
            background-color: #2c3e50;
            color: #ecf0f1;
            border-radius: 10px;
            padding: 20px;
            overflow-x: auto;
        }

        .bg-light {
            background: linear-gradient(to bottom, #ffffff, #e8f5e9);
        }

        @media (max-width: 768px) {
            .feature-card {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">Plant Monitoring System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#dashboard">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="#features">Features</a></li>
                    <li class="nav-item"><a class="nav-link" href="#code">System Code</a></li>
                    <li class="nav-item"><a class="nav-link" href="#cnn-dashboard">CNN Model</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Dashboard Section -->
    <section id="dashboard" class="py-5 mt-5">
        <div class="container">
            <h2 class="section-label">System Dashboard</h2>
            <div class="row">
                <div class="col-md-3">
                    <div class="feature-card text-center">
                        <i class="fas fa-thermometer-half"></i>
                        <h4>Temperature</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card text-center">
                        <i class="fas fa-tint"></i>
                        <h4>Humidity</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card text-center">
                        <i class="fas fa-leaf"></i>
                        <h4>Soil Moisture</h4>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="feature-card text-center">
                        <i class="fas fa-sun"></i>
                        <h4>UV Index</h4>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <a href="https://app.arduino.cc/dashboards/54f7189a-b446-42d2-888d-c1331f7b474b" 
                   target="_blank" class="btn dashboard-button btn-lg">
                    View Full Dashboard
                </a>
            </div>
        </div>
    </section>

    <!-- CNN Model Section -->
    <section id="cnn-dashboard" class="py-5 bg-light">
        <div class="container">
            <h2 class="section-label">CNN Model Dashboard</h2>
            <p class="text-center">Explore detailed insights and predictions using our CNN-based model.</p>
            <div class="text-center mt-4">
                <a href="https://cnn-model-9ipvvdrzkwkxzl7bckcvda.streamlit.app/" 
                   target="_blank" class="btn dashboard-button btn-lg">
                    View CNN Dashboard
                </a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5">
        <div class="container">
            <h2 class="section-label">System Features</h2>
            <div class="row">
                <div class="col-md-4 text-center">
                    <div class="feature-card">
                        <i class="fas fa-mountain"></i>
                        <h3>Environmental Tracking</h3>
                        <p>Comprehensive monitoring of temperature, humidity, and UV exposure</p>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="feature-card">
                        <i class="fas fa-seedling"></i>
                        <h3>Plant Health Insights</h3>
                        <p>Real-time soil moisture and condition analysis</p>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div class="feature-card">
                        <i class="fas fa-bell"></i>
                        <h3>Alert System</h3>
                        <p>Instant notifications for critical environmental changes</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Code Section -->
    <section id="code" class="py-5">
        <div class="container">
            <h2 class="section-label">System Code</h2>
            <div class="code-container">
                <pre><code id="codeDisplay" class="language-cpp"></code></pre>
            </div>
        </div>
    </section>

    <script>
        const codeContent = `#include "arduino_secrets.h"
#include "thingProperties.h"
#include <DHT.h>

// Pin definitions
#define DHTPIN 4
#define DHTTYPE DHT22
#define SOIL_MOISTURE_PIN 35
#define UV_SENSOR_PIN 34
#define BUZZER_PIN 27  

// Thresholds for plant conditions
const float TEMP_LOW = 15.0;
const float TEMP_HIGH = 30.0;
const float HUMIDITY_LOW = 40.0;
const float HUMIDITY_HIGH = 80.0;
const int SOIL_MOISTURE_LOW = 30;
const int SOIL_MOISTURE_HIGH = 90;

// Updated UV Index Thresholds
const int UV_LOW = 1;
const int UV_PROTECTION_THRESHOLD = 4;
const int UV_HIGH = 11;

// Buzzer alert thresholds
const float TEMP_ALERT_THRESHOLD = 35.0;
const float HUMIDITY_ALERT_THRESHOLD = 85.0;
const int SOIL_MOISTURE_ALERT_THRESHOLD = 95;

DHT dht(DHTPIN, DHTTYPE);

struct PlantConditions {
    float temperature;
    float humidity;
    int soilMoisture;
    int uvLevel;
    String tempStatus;
    String humidityStatus;
    String soilStatus;
    String uvStatus;
    String overallStatus;
};

int calculateSoilMoisture(int rawValue) {
    return map(rawValue, 4095, 0, 0, 100);
}

void setupBuzzer() {
    pinMode(BUZZER_PIN, OUTPUT);
}

void alertBuzzer(int duration = 500, int frequency = 1000) {
    // Activate buzzer with optional duration and frequency
    tone(BUZZER_PIN, frequency, duration);
}

void checkAndTriggerAlerts(PlantConditions &conditions) {
    bool shouldAlert = false;

    // Temperature alert
    if (conditions.temperature > TEMP_ALERT_THRESHOLD) {
        Serial.println("ALERT: Temperature Extremely High!");
        shouldAlert = true;
    }

    // Humidity alert
    if (conditions.humidity > HUMIDITY_ALERT_THRESHOLD) {
        Serial.println("ALERT: Humidity Extremely High!");
        shouldAlert = true;
    }

    // Soil Moisture alert
    if (conditions.soilMoisture > SOIL_MOISTURE_ALERT_THRESHOLD) {
        Serial.println("ALERT: Soil Moisture Extremely High!");
        shouldAlert = true;
    }

    // Trigger buzzer if any condition exceeds threshold
    if (shouldAlert) {
        // Multiple buzz patterns can be implemented
        alertBuzzer(1000);  // Long buzz for 1 second
        delay(200);
        alertBuzzer(500);   // Shorter follow-up buzz
    }
}

void analyzePlantConditions(PlantConditions &conditions) {
    // Analyze temperature
    if (conditions.temperature < TEMP_LOW) {
        conditions.tempStatus = "Too Cold";
    } else if (conditions.temperature > TEMP_HIGH) {
        conditions.tempStatus = "Too Hot";
    } else {
        conditions.tempStatus = "Optimal";
    }
    
    // Analyze humidity
    if (conditions.humidity < HUMIDITY_LOW) {
        conditions.humidityStatus = "Too Dry";
    } else if (conditions.humidity > HUMIDITY_HIGH) {
        conditions.humidityStatus = "Too Humid";
    } else {
        conditions.humidityStatus = "Optimal";
    }
    
    // Analyze soil moisture
    if (conditions.soilMoisture < SOIL_MOISTURE_LOW) {
        conditions.soilStatus = "Needs Water";
    } else if (conditions.soilMoisture > SOIL_MOISTURE_HIGH) {
        conditions.soilStatus = "Over Watered";
    } else {
        conditions.soilStatus = "Optimal";
    }
    
    // Analyze UV level with new thresholds
    if (conditions.uvLevel < UV_PROTECTION_THRESHOLD) {
        conditions.uvStatus = "Low Exposure";
    } else {
        conditions.uvStatus = "Protection Needed";
    }
    
    // Determine overall status
    if (conditions.tempStatus == "Optimal" && 
        conditions.humidityStatus == "Optimal" && 
        conditions.soilStatus == "Optimal" && 
        conditions.uvStatus == "Low Exposure") {
        conditions.overallStatus = "All conditions optimal";
    } else {
        conditions.overallStatus = "Needs attention";
    }
}

String getPlantAdvice(PlantConditions &conditions) {
    String advice = "";
    
    if (conditions.tempStatus != "Optimal") {
        if (conditions.tempStatus == "Too Cold") {
            advice += "Move to warmer location. ";
        } else {
            advice += "Provide shade or cooling. ";
        }
    }
    
    if (conditions.humidityStatus != "Optimal") {
        if (conditions.humidityStatus == "Too Dry") {
            advice += "Increase humidity (misting/humidifier). ";
        } else {
            advice += "Improve air circulation. ";
        }
    }
    
    if (conditions.soilStatus != "Optimal") {
        if (conditions.soilStatus == "Needs Water") {
            advice += "Water needed. ";
        } else {
            advice += "Reduce watering, check drainage. ";
        }
    }
    
    if (conditions.uvStatus == "Protection Needed") {
        advice += "High UV exposure detected. Provide shade or UV protection. ";
    }
    
    return advice.length() > 0 ? advice : "All conditions are optimal. Continue current care routine.";
}

void setup() {
    Serial.begin(9600);
    delay(1500); 
    
    // Setup buzzer
    setupBuzzer();
    
    // Initialize IoT cloud properties
    initProperties();
    ArduinoCloud.begin(ArduinoIoTPreferredConnection);
    setDebugMessageLevel(2);
    ArduinoCloud.printDebugInfo();
    
    // Initialize DHT sensor
    dht.begin();
}

void loop() {
    ArduinoCloud.update();

    // Read sensors
    float temperature = dht.readTemperature();
    float humidity = dht.readHumidity();
    int soilMoistureValue = analogRead(SOIL_MOISTURE_PIN);
    int moisturePercent = calculateSoilMoisture(soilMoistureValue);
    
    // Updated UV index calculation
    int sensor_value = analogRead(UV_SENSOR_PIN);
    float volts = sensor_value * 5.0 / 1024.0;
    int uvIndex = round(volts);
    uvIndex = constrain(uvIndex, 1, 11);

    // Populate conditions structure
    PlantConditions conditions;
    conditions.temperature = temperature;
    conditions.humidity = humidity;
    conditions.soilMoisture = moisturePercent;
    conditions.uvLevel = uvIndex;

    // Update cloud variables
    temp = temperature;
    humid = humidity;
    soilmoisture = moisturePercent;
    uv_index = uvIndex;

    // Analyze plant conditions
    analyzePlantConditions(conditions);
    String advice = getPlantAdvice(conditions);

    // Update status variables
    plantStatus = conditions.overallStatus;
    plantAdvice = advice;

    // Check and trigger alerts
    checkAndTriggerAlerts(conditions);

    // Debug output
    Serial.println("\n--- Plant Monitor Report ---");
    Serial.printf("Temperature: %.1f°C\n", temperature);
    Serial.printf("Humidity: %.1f%%\n", humidity);
    Serial.printf("Soil Moisture: %d%%\n", moisturePercent);
    Serial.printf("UV Index: %d\n", uvIndex);
    Serial.printf("Overall Status: %s\n", conditions.overallStatus.c_str());
    Serial.printf("Advice: %s\n", advice.c_str());
    Serial.println("-------------------------\n");

    // Wait for 25 seconds before next reading
    delay(25000);
}

// Callback functions
void onTempChange() {
    Serial.printf("Temperature changed to: %.1f°C\n", temp);
}

void onHumidChange() {
    Serial.printf("Humidity changed to: %.1f%%\n", humid);
}

void onSoilmoistureChange() {
    Serial.printf("Soil moisture changed to: %d%%\n", soilmoisture);
}

void onUvIndexChange() {
    Serial.printf("UV Index changed to: %d\n", uv_index);
}

void onPlantAdviceChange() {
    Serial.println("Plant Advice Updated: " + plantAdvice);
}

void onPlantStatusChange() {
    Serial.println("Plant Status Changed: " + plantStatus);
}`;
        document.getElementById('codeDisplay').textContent = codeContent;
    </script>
</body>
</html>
